# eSewa SDK for PHP

[![@cixware on Twitter](https://img.shields.io/badge/Twitter-%40cixware-blue.svg?style=flat&logo=twitter)](https://twitter.com/cixware)
[![@cixware on Facebook](https://img.shields.io/badge/Facebok-%40cixware-blue.svg?style=flat&logo=facebook)](https://www.facebook.com/cixware)
![PHP Version](https://img.shields.io/packagist/php-v/cixware/esewa-php-sdk)
![Build](https://img.shields.io/github/actions/workflow/status/cixware/esewa-php-sdk/install.yml?branch=main&logo=github)
[![Downloads](https://img.shields.io/packagist/dt/cixware/esewa-php-sdk.svg?style=flat&label=Downloads)](https://packagist.org/packages/cixware/esewa-php-sdk)
![License](https://img.shields.io/github/license/cixware/esewa-php-sdk)

We at [Cixware] develop and maintain the **eSewa SDK for PHP**, making it easy for developers to integrate the eSewa
payment service into their PHP code. Find more details on the [eSewa Documentation] website.

## Getting Started

1. **Sign up for eSewa** – Before you begin, you need to sign up and retrieve your credentials from [eSewa].
2. **Minimum requirements** – To run the SDK, your system will need to meet the minimum requirements, including having *
   *PHP >= 7.4**. We highly recommend having it compiled with the cURL extension and cURL compiled with a TLS backend (
   e.g., NSS or OpenSSL).

## Installation

**Install the SDK** – Using [Composer] is the recommended way to install the eSewa SDK for PHP. The SDK is available
via [Packagist] under the [`cixware/esewa-php-sdk`][install-packagist] package.

```
composer require cixware/esewa-php-sdk
```

## Getting Help

We track bugs and feature requests using GitHub issues and prioritize addressing them ASAP.

* For account and payment related concerns, please reach [eSewa] by calling or emailing them.
* If you believe you have found a bug, please [open an issue](https://github.com/cixware/esewa-php-sdk/issues/new) on
  GitHub.
* For assistance with integrating eSewa into your application, don't hesitate to contact [Cixware].

## Quick Examples

### Create an eSewa client

```php
// Init composer autoloader.
require 'vendor/autoload.php';

use Cixware\Esewa\Client;use Cixware\Esewa\Config;

// Set success and failure callback URLs.
$successUrl = 'https://example.com/success.php';
$failureUrl = 'https://example.com/failed.php';

// Config for development.
$config = new Config($successUrl, $failureUrl);

// Config for production.
$config = new Config($successUrl, $failureUrl, 'b4e...e8c753...2c6e8b');

// Initialize eSewa client.
$esewa = new Client($config);
```

Here `b4e...e8c753...2c6e8b` is merchant code retrieved from eSewa.

### Make Payment

When the user initiates the payment process, the package redirects the user to an eSewa site for payment processing. The
eSewa system will redirect the user to your specified success URL if the payment is successful and to the failure URL if
the payment fails.

```php
$esewa->process('P101W201', 100, 15, 80, 50);
```

The method accepts 5 parameters.

1. `pid` A unique ID of product or item or ticket etc.
2. `amt` Amount of product or item or ticket etc
3. `txAmt` Tax amount on product or item or ticket etc. Pass `0` if Tax/VAT is not applicable.
4. `psc` The service charge (if applicable); default to `0`.
5. `pdc` The delivery charge (if applicable); default to `0`.

The `tAmt` total amount is auto calculated based on the parameters.

### OTP for Payment
When using the eSewa payment gateway in production mode, an OTP (One-Time Password) code is sent to the customer's mobile number to verify the transaction. In development mode, the OTP code is a fixed six-digit number, `123456`, for testing purposes.

```php

```php

### Verify Payment

The verification process identifies potentially fraudulent transactions and checks them against data such as transaction
amount and other parameters.

```php
$status = $esewa->verify('R101', 'P101W201', 245);
if ($status) {
    // Verification successful.
}
```

The method accepts 3 parameters.

1. `refId` A unique payment reference code generated by eSewa.
2. `oid` Product ID used on payment request.
3. `tAmt` Total payment amount (including Tax/VAT and other charges.)

**Note:** You can extract `refId` from the success response url parameter.

# Contribution

We highly value and appreciate the contributions of the Open Source community. To ensure a smooth and efficient process,
please stick to the following guidelines when submitting code:

- Ensure that your code adheres to [PSR] standards.
- All submitted code must pass relevant tests.
- Proper documentation and clean code practices are a must.
- Please make pull requests to the `main` branch.

Thank you for your support and contributions. We look forward to reviewing your code.

[eSewa]: https://esewa.com.np

[eSewa Documentation]: https://developer.esewa.com.np

[Cixware]: https://cixware.io

[composer]: http://getcomposer.org

[packagist]: http://packagist.org

[install-packagist]: https://packagist.org/packages/cixware/esewa-php-sdk

[PSR]: https://www.php-fig.org/psr